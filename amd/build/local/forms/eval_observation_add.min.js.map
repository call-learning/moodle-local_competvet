{"version":3,"file":"eval_observation_add.min.js","sources":["../../../src/local/forms/eval_observation_add.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript adding a new observation.\n *\n * @module     local_competvet/local/forms/observation_add_form\n * @copyright  2023 Laurent David <laurent@call-learning.fr>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Ajax from 'core/ajax';\nimport ModalEvents from 'core/modal_events';\nimport {genericFormCreate, getSelectedElement} from \"mod_competvet/local/forms/generic_form_helper\";\nimport {createModalDebug, createModalDebugFromEvent} from \"./modal_debug\";\nimport {get_string as getString} from 'core/str';\n\nexport const init = async (modulename) => {\n    const selectedElements = getSelectedElement('add');\n    if (!selectedElements) {\n        return;\n    }\n    selectedElements.forEach((element) => {\n        element.addEventListener('click', async (event) => {\n            event.preventDefault();\n            const data = event.target.closest('[data-action]').dataset;\n            let datasetLowercase = Object.entries(data).reduce((acc, [key, value]) => {\n                acc[key.toLowerCase()] = value; // Convert key to lowercase\n                return acc;\n            }, {});\n            const payLoad = {\n                category: 1, // Observation.\n                planningid: datasetLowercase.planningid,\n                studentid: datasetLowercase.studentid,\n            };\n            const observation = await Ajax.call([\n                {\n                    methodname: `local_competvet_create_eval_observation`,\n                    args: payLoad,\n                }\n            ])[0];\n            const modal = await createModalDebug({\n                content: await getString('observation:created', 'local_competvet'),\n                debugs: [\n                    {\n                        apifunction: 'local_competvet_ask_eval_observation',\n                        params: JSON.stringify(payLoad),\n                        results: [\n                            JSON.stringify(observation)\n                        ]\n                    }\n                ]\n            });\n            modal.show();\n            modal.getRoot().on(ModalEvents.cancel, () => {\n                genericFormCreate({'id' : observation.observationid }, 'edit', modulename, createModalDebugFromEvent);\n            });\n        });\n    });\n};\n"],"names":["async","selectedElements","forEach","element","addEventListener","event","preventDefault","data","target","closest","dataset","datasetLowercase","Object","entries","reduce","acc","key","value","toLowerCase","payLoad","category","planningid","studentid","observation","Ajax","call","methodname","args","modal","content","debugs","apifunction","params","JSON","stringify","results","show","getRoot","on","ModalEvents","cancel","observationid","modulename","createModalDebugFromEvent"],"mappings":";;;;;;;wLA4BoBA,MAAAA,mBACVC,kBAAmB,2CAAmB,OACvCA,kBAGLA,iBAAiBC,SAASC,UACtBA,QAAQC,iBAAiB,SAASJ,MAAAA,QAC9BK,MAAMC,uBACAC,KAAOF,MAAMG,OAAOC,QAAQ,iBAAiBC,YAC/CC,iBAAmBC,OAAOC,QAAQN,MAAMO,QAAO,CAACC,gBAAMC,IAAKC,mBAC3DF,IAAIC,IAAIE,eAAiBD,MAClBF,MACR,UACGI,QAAU,CACZC,SAAU,EACVC,WAAYV,iBAAiBU,WAC7BC,UAAWX,iBAAiBW,WAE1BC,kBAAoBC,cAAKC,KAAK,CAChC,CACIC,qDACAC,KAAMR,WAEX,GACGS,YAAc,iCAAiB,CACjCC,cAAe,mBAAU,sBAAuB,mBAChDC,OAAQ,CACJ,CACIC,YAAa,uCACbC,OAAQC,KAAKC,UAAUf,SACvBgB,QAAS,CACLF,KAAKC,UAAUX,kBAK/BK,MAAMQ,OACNR,MAAMS,UAAUC,GAAGC,sBAAYC,QAAQ,gDACjB,IAAQjB,YAAYkB,eAAiB,OAAQC,WAAYC"}